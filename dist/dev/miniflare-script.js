function f(e){let t=[],o=[];for(let[s,r]of Array.from(e.entries()))if(s.startsWith("FILE_"))t.push(r);else if(s.startsWith("FILES_")){if(o.includes(s))continue;o.push(s),t.push(e.getAll(s))}else t.push(JSON.parse(decodeURI(r)));return t}function c(e){return e.searchParams.entries().toArray().map(([o,s])=>s).map((o)=>JSON.parse(decodeURIComponent(o)))}async function u(e,t){if(e.request.headers.get("x-server-action")!=="true")return new Response("Not Found",{status:404});let s=e.request.method;if(!(s in t))return new Response(`Method ${s} Not Allowed`,{status:405});let r=t[s];if(typeof r!=="function")return new Response(`Method ${s} Not Implemented`,{status:501});let p=e.request.method==="GET"||e.request.method==="HEAD"?c(new URL(e.request.url)):f(await e.request.formData()),d=r.length-p.length;for(let i=0;i<d;i++)p.push(void 0);p.push(e);let n=await r(...p);switch(typeof n){case"string":case"number":case"boolean":case"bigint":let i=new Response(JSON.stringify(n));return i.headers.set("Content-Type","application/json"),i.headers.set("dataType","json"),i;case"undefined":return new Response(null,{status:204});case"object":if(n instanceof Response)return n.headers.set("dataType","response"),n;else if(n instanceof Blob){let a=new Response(await n.arrayBuffer());return a.headers.set("dataType","blob"),a.headers.set("Content-Type",n.type),a}else if(n instanceof File){let a=new Response(await n.arrayBuffer());return a.headers.set("dataType","file"),a.headers.set("Content-Type",n.type),a.headers.set("fileData",JSON.stringify({name:n.name,lastModified:n.lastModified})),a}else return new Response(JSON.stringify(n),{headers:{"Content-Type":"application/json",dataType:"json"}});default:throw Error(`Unsupported return type from action: ${typeof n}`)}}var T=async(e)=>{let t=e.request.method,o={GET:typeof GET==="function"?GET:void 0,POST:typeof POST==="function"?POST:void 0,PUT:typeof PUT==="function"?PUT:void 0,DELETE:typeof DELETE==="function"?DELETE:void 0,PATCH:typeof PATCH==="function"?PATCH:void 0,HEAD:typeof HEAD==="function"?HEAD:void 0,OPTIONS:typeof OPTIONS==="function"?OPTIONS:void 0};if(!o[t])return new Response("Method Not Allowed",{status:405});return await u(e,o)};export{T as onRequest};
