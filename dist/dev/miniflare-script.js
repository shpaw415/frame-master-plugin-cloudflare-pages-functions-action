function f(n){let o=[],s=[];for(let[t,r]of Array.from(n.entries()))if(t.startsWith("FILE_"))o.push(r);else if(t.startsWith("FILES_")){if(s.includes(t))continue;s.push(t),o.push(n.getAll(t))}else o.push(JSON.parse(decodeURI(r)));return o}function d(n){return n.searchParams.entries().toArray().map(([s,t])=>t).map((s)=>JSON.parse(decodeURIComponent(s)))}async function i(n,o){let s=n.request.method;if(!(s in o))return new Response(`Method ${s} Not Allowed`,{status:405});let t=o[s];if(typeof t!=="function")return new Response(`Method ${s} Not Implemented`,{status:501});let r=n.request.method==="GET"||n.request.method==="HEAD"?d(new URL(n.request.url)):f(await n.request.formData()),u=t.length-r.length;for(let p=0;p<u;p++)r.push(void 0);r.push(n);let e=await t(...r);switch(typeof e){case"string":case"number":case"boolean":case"bigint":let p=new Response(JSON.stringify(e));return p.headers.set("Content-Type","application/json"),p.headers.set("dataType","json"),p;case"undefined":return new Response(null,{status:204});case"object":if(e instanceof Response)return e.headers.set("dataType","response"),e;else if(e instanceof Blob){let a=new Response(await e.arrayBuffer());return a.headers.set("dataType","blob"),a.headers.set("Content-Type",e.type),a}else if(e instanceof File){let a=new Response(await e.arrayBuffer());return a.headers.set("dataType","file"),a.headers.set("Content-Type",e.type),a.headers.set("fileData",JSON.stringify({name:e.name,lastModified:e.lastModified})),a}else return new Response(JSON.stringify(e),{headers:{"Content-Type":"application/json",dataType:"json"}});default:throw Error(`Unsupported return type from action: ${typeof e}`)}}var l=async(n)=>{let o=n.request.method,s={GET:typeof GET==="function"?GET:void 0,POST:typeof POST==="function"?POST:void 0,PUT:typeof PUT==="function"?PUT:void 0,DELETE:typeof DELETE==="function"?DELETE:void 0,PATCH:typeof PATCH==="function"?PATCH:void 0,HEAD:typeof HEAD==="function"?HEAD:void 0,OPTIONS:typeof OPTIONS==="function"?OPTIONS:void 0};if(!s[o])return new Response("Method Not Allowed",{status:405});return await i(n,s)};export{l as onRequest};
